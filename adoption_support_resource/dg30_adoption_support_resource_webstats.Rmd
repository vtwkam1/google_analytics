---
title: "DG30 adoption support resource page views and downloads"
author: "Impact team"
date: "`r Sys.Date()`"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
        theme:
            bg: "#F7F4F1"
            fg: "#000000"
            primary: "#228096"
            secondary: "#00436C"
            base_font: 
                google: "Inter"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      include = FALSE)

if (!require(pacman)) {
    install.packages(pacman)
}
pacman::p_load(tidyverse, lubridate, plotly, reactable)

# Declare location
here::i_am("adoption_support_resource/dg30_adoption_support_resource_webstats.Rmd")
```

# Introduction

This page presents the monthly page views and downloads of the [NICE adoption support resource for DG30 quantitative faecal immunochemical tests to guide referral for colorectal cancer in primary care](https://www.nice.org.uk/guidance/dg30/resources/adoption-support-resource-insights-from-the-nhs-169975784916/chapter/1-Introduction), using Google Analytics data from the [health and social care (HSC) dashboard](https://datastudio.google.com/u/0/reporting/f35ae256-7912-4f05-8838-79937f289faf/page/p_oqpodkxvuc).

The data covers June 2019 to November 2022. The period in between the DG30 guidance publishing (July 2017) and the earliest date where Google Analytics data is available (June 2019) is not captured.

Note, Google Analytics samples from a website's traffic data to estimate measures like page views and downloads. Also note that a page view is recorded each time a page loads.

# Page views {.tabset}

## Graph

```{r}
views_raw <- read_csv(here::here("output/dg30_adoption_support_resource_views_data_2022-12-28.csv"),
                      col_types = "Dcdd") %>% 
    mutate(page_views = coalesce(views, page_views)) %>% 
    select(-views) %>% 
    mutate(section = case_when(str_detect(page_path, "how-to-implement") ~ "6 How to implement NICE's guidance",
                            str_detect(page_path, "introduction") ~ "1 Introduction"),
           .before = page_views)
```

```{r}
views <- views_raw %>% 
    group_by(year_month, section) %>% 
    summarise(page_views = sum(page_views)) %>% 
    ungroup()
```

The [1 Introduction](https://www.nice.org.uk/guidance/dg30/resources/adoption-support-resource-insights-from-the-nhs-169975784916/chapter/1-Introduction) section is the page users land on when they click on "Adoption support for quantitative faecal immunochemical tests to guide referral for colorectal cancer in primary care: insights from the NHS" under "Implementation support" in the [Tools and resources](https://www.nice.org.uk/guidance/dg30/resources) page of DG30.

The [6 How to implement NICE's guidance on quantitative faecal immunochemical tests to guide referral for colorectal cancer in primary care](https://www.nice.org.uk/guidance/dg30/resources/adoption-support-resource-insights-from-the-nhs-169975784916/chapter/6-How-to-implement-NICEs-guidance-on-quantitative-faecal-immunochemical-tests-to-guide-referral-for-colorectal-cancer-in-primary-care) section contains the most important information in the adoption support resource - advice on how to implement this piece of NICE guidance.

The graph below shows the page views for each of these sections over time:

```{r, include = TRUE}
views %>% 
    plot_ly(x = ~year_month,
            y = ~page_views,
            color = ~section,
            type = "scatter",
            mode = "lines",
            hovertemplate = "Views : %{y}") %>% 
    layout(xaxis = list(title = list(text = "Month")),
           yaxis = list(title = list(text = "Page views")),
           hovermode = "x unified")
```
## Table

Page views for [1 Introduction](https://www.nice.org.uk/guidance/dg30/resources/adoption-support-resource-insights-from-the-nhs-169975784916/chapter/1-Introduction):

```{r, include = TRUE}
views_raw %>% 
    filter(section == "1 Introduction") %>% 
    select(-section) %>% 
    reactable(columns = list(
                  year_month = colDef(name = "Month"),
                  page_path = colDef(name = "Page URL"),
                  page_views = colDef(name = "Page views")
              )
              )
```

Page views for [6 How to implement NICE's guidance on quantitative faecal immunochemical tests to guide referral for colorectal cancer in primary care](https://www.nice.org.uk/guidance/dg30/resources/adoption-support-resource-insights-from-the-nhs-169975784916/chapter/6-How-to-implement-NICEs-guidance-on-quantitative-faecal-immunochemical-tests-to-guide-referral-for-colorectal-cancer-in-primary-care):

Note, two URLs were identified which point to this same section:

- [https://www.nice.org.uk/guidance/dg30/resources/adoption-support-resource-insights-from-the-nhs-169975784916/chapter/6-How-to-implement-NICEs-guidance-on-quantitative-faecal-immunochemical-tests-to-guide-referral-for-colorectal-cancer-in-primary-care]()
- [www.nice.org.uk/guidance/dg30/resources/adoption-support-resource-insights-from-the-nhs-169975784916/chapter/how-to-implement-nices-guidance-on-quantitative-faecal-immunochemical-tests-to-guide-referral-for]()

```{r, include = TRUE}
views_raw %>% 
    filter(section == "6 How to implement NICE's guidance") %>% 
    select(-section) %>% 
    reactable(groupBy = c("year_month"),
              columns = list(
                  year_month = colDef(name = "Month"),
                  page_path = colDef(name = "Page URL"),
                  page_views = colDef(aggregate = "sum",
                                      name = "Page views")
              )
              )

```

# Downloads

The adoption support resource is also available as a [PDF to download](https://www.nice.org.uk/guidance/dg30/resources/adoption-support-for-quantitative-faecal-immunochemical-tests-to-guide-referral-for-colorectal-cancer-in-primary-care-insights-from-the-nhs-pdf-220288617251125).

This PDF only appeared twice in the Google Analytics data capturing the download figures of all documents on the NICE website between June 2019 and November 2022, suggesting it is not downloaded much at all.

```{r}
downloads_raw <- read_csv(here::here("output/dg30_adoption_support_resource_downloads_data_2022-12-28.csv"),
                      col_types = "Dccdd") %>% 
    mutate(downloads = coalesce(downloads, total_events)) %>% 
    select(-total_events)
```

```{r, include = TRUE}
downloads_raw %>% 
    select(-page_path) %>% 
    reactable(columns = list(
                  year_month = colDef(name = "Month"),
                  file = colDef(name = "File URL"),
                  downloads = colDef(name = "Downloads")
              ),
              elementId = "downloads"
              )
```

